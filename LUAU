local remotes = game.ReplicatedStorage:FindFirstChild("Remotes")
local Animaciones =game:GetService("ServerStorage"):FindFirstChild("Animaciones")

local sync = require(game:GetService("ServerStorage"):FindFirstChild("Sync"))
local cache = require(game:GetService("ServerStorage"):FindFirstChild("Sync"):FindFirstChild("Cache"))
game.Players.PlayerAdded:Connect(function(plr)
	plr.CharacterAdded:Connect(function(char)

        local BoolValue = Instance.new("BoolValue")
        local Player1 = Instance.new("StringValue")
        local Player2 = Instance.new("StringValue")
        Player1.Name = "Player1"
        Player2.Name = "Player2"
        BoolValue.Name = "Sync"
        BoolValue.Value = false
        Player1.Parent = BoolValue
        Player2.Parent = BoolValue
        BoolValue.Parent = char
        local danceName = Instance.new("StringValue")
        danceName.Parent = char
		danceName.Name = "Dance"


 end)
end)

function EjecutarAnimacionSolo(plr1,anim)
	local Search = Animaciones:FindFirstChild(anim)
	sync.PlayAnim(plr1,Search,"Solo")
end
function EjecutarAnimacion(plr1,plr2,anim)
	local Search = Animaciones:FindFirstChild(anim)
	sync.PlayAnim(plr1,plr2,Search)
end
function CrearProxy(plr,anim)
    local Proxy = Instance.new("ProximityPrompt")
    Proxy.ActionText = "Bailar:"..anim
    Proxy.Name = "ProxySync"
    Proxy.Parent = plr.Character:FindFirstChild("HumanoidRootPart")
    Proxy.RequiresLineOfSight = false
    Proxy.Triggered:Connect(function(request)
        if request.Character:FindFirstChild("Sync").Value == true then
        elseif  request.Character:FindFirstChild("HumanoidRootPart"):FindFirstChild("ProxySync") then
            request.Character:FindFirstChild("HumanoidRootPart"):FindFirstChild("ProxySync"):Destroy()
            EjecutarAnimacion(plr,request,anim)
        else
            EjecutarAnimacion(plr,request,anim)
        end
    end)
end

remotes.Duo.OnServerEvent:Connect(function(plr,anim,PlayStop)
	print(PlayStop)
	if PlayStop == "Favorito" then
		

	end
if PlayStop == "Play" then
	
        print(PlayStop)
        if plr.Character:FindFirstChild("Sync").Value == true then
            print( plr.Character:FindFirstChild("Sync").Value)   print( plr.Character:FindFirstChild("Sync").Value)
        elseif plr.Character:FindFirstChild("HumanoidRootPart"):FindFirstChild("ProxySync") then
            local Proxy = plr.Character:FindFirstChild("HumanoidRootPart"):FindFirstChild("ProxySync")
            Proxy:Destroy()
            CrearProxy(plr,anim)
        else
            CrearProxy(plr,anim)
		end

else
    print(PlayStop)
    if plr.Character:FindFirstChild("Sync").Value == true then
        sync.Stop(plr)
       sync.Desincronizar(plr)
            print( plr.Character:FindFirstChild("Sync").Value)
        print("intentando detener")
    elseif plr.Character:FindFirstChild("HumanoidRootPart"):FindFirstChild("ProxySync") then
        plr.Character:FindFirstChild("HumanoidRootPart"):FindFirstChild("ProxySync"):Destroy()
    end
    
end
end)
remotes.cambio.OnServerEvent:Connect(function(plr)
    sync.Cambio(plr)
end)
remotes.Solo.OnServerEvent:Connect(function(plr,anim,msg)
print("Serivodr solo: ",msg)
	if msg == "Favoritos" then

end
    if plr.Character:FindFirstChild("Sync").Value == true then
        sync.Stop(plr)
       sync.Desincronizar(plr)
        print( plr.Character:FindFirstChild("Sync").Value)
    elseif plr.Character:FindFirstChild("HumanoidRootPart"):FindFirstChild("ProxySync") then
		plr.Character:FindFirstChild("HumanoidRootPart"):FindFirstChild("ProxySync"):Destroy()
    else
        sync.Desincronizar(plr)
        EjecutarAnimacionSolo(plr,anim)
    end
end)
remotes.Sync.OnServerEvent:Connect(function(plr,request,Text)
 if Text == "Stop" then
        sync.Desincronizar(plr)
        sync.Stop(plr)
 elseif Text == "Play" then
        sync.Sync(plr,request)
 end

end)
remotes.Hug.hug.OnServerEvent:Connect(function(Plr,Request,Nombre,Lugar)
remotes.Hug.Request:FireClient(Request,Plr,Nombre,Lugar)
end)
remotes.Hug.empezar.OnServerEvent:Connect(function(plr,client,nombre,Request)
	print(plr,client,nombre,Request)
remotes.Hug.ambos:FireClient(plr,true)
	remotes.Hug.ambos:FireClient(client,true)
	sync.Stop(plr)
	sync.Desincronizar(plr)
	sync.Abacho(plr,client,nombre,Request)
end)
remotes.Hug.StopHug.OnServerEvent:Connect(function(plr)

		print(plr.Name,"quiere dejar de abrazar")
		sync.DejarDeabachar(plr)
		task.wait(0.1)
	local Existe = plr.Character:FindFirstChild("UpperTorso"):FindFirstChild("welding")
	if Existe then
		Existe:Destroy()
	end
end)

remotes.Velocity.OnServerEvent:Connect(function(player, velocidad)
	local rounded = math.round(velocidad * 10) / 10 -- redondear a 0.1
	sync.Velocidad(player,rounded)
end)
---------------------------------------------------------------------------




